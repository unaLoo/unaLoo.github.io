---
title: 'å¼€å‘æ—¶æ„å»ºæ€§èƒ½ä¼˜åŒ–'
date: 2025-06-23
permalink: /posts/buildOptimize/
tags:
  - å‰ç«¯å·¥ç¨‹åŒ–

---

> æ‰“åŒ…ä¼˜åŒ–æ˜¯å‰ç«¯å·¥ç¨‹åŒ–ä¸­çš„ä¸€ä¸ªé‡è¦ç¯èŠ‚ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æé«˜ä»£ç çš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œè¿™é‡Œæ‹æ‹å¼€å‘æ—¶çš„æ„å»ºæ€§èƒ½ä¼˜åŒ–ã€‚

----

## ç›®å½•
- [æ‰“åŒ…æ€§èƒ½ä¼˜åŒ–](#æ‰“åŒ…æ€§èƒ½ä¼˜åŒ–)
- [1. å‡å°‘æ¨¡å—è§£æ](#1-å‡å°‘æ¨¡å—è§£æ)
  - [åªè§£ææœ‰ä¾èµ–å…¶ä»–æ¨¡å—çš„æ¨¡å—](#åªè§£ææœ‰ä¾èµ–å…¶ä»–æ¨¡å—çš„æ¨¡å—)
- [2. ä¼˜åŒ–loaderæ€§èƒ½](#2-ä¼˜åŒ–loaderæ€§èƒ½)
  - [åªå¤„ç†éœ€è¦çš„æ–‡ä»¶](#åªå¤„ç†éœ€è¦çš„æ–‡ä»¶)
  - [ç¼“å­˜loaderçš„ç»“æœ](#ç¼“å­˜loaderçš„ç»“æœ)
  - [loaderå¤šçº¿ç¨‹è¿è¡Œ](#loaderå¤šçº¿ç¨‹è¿è¡Œ)

- [3. çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰](#3-çƒ­æ¨¡å—æ›¿æ¢hmr)



## æ‰“åŒ…æ€§èƒ½ä¼˜åŒ–
    
æ‰“åŒ…åœºæ™¯ä¸‹çš„æ€§èƒ½æŒ‡æ ‡
    
1. å¼€å‘é˜¶æ®µçš„æ„å»ºæ€§èƒ½ï¼šæ„å»ºè¶Šå¿«è¶Šå¥½ï¼Œ*æŒ‰éœ€æ„å»º*ï¼Œ*ç¼“å­˜å¤ç”¨*
    
2. ç”Ÿäº§é˜¶æ®µçš„ä¼ è¾“æ€§èƒ½ï¼šä¼ è¾“è¶Šå¿«è¶Šå¥½, *æ‰“åŒ…ç»“æœä½“ç§¯è¶Šå°è¶Šå¥½* *æ–‡ä»¶æ•°é‡ä¼˜åŒ–* *åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜*
    
## 1. å‡å°‘æ¨¡å—è§£æ

### åªè§£ææœ‰ä¾èµ–å…¶ä»–æ¨¡å—çš„æ¨¡å—
> æ ¸å¿ƒï¼šæ˜¾ç¤ºæŒ‡å®šä¸éœ€è¦è§£æçš„æ¨¡å—
    
**æ¨¡å—è§£æ**
æ¨¡å—è§£ææ˜¯æŒ‡webpackä»entryå¼€å§‹ï¼Œ**é€’å½’åœ°è§£æä¾èµ–çš„æ¨¡å—**ï¼Œå¹¶ç”Ÿæˆä¾èµ–å›¾è°±çš„è¿‡ç¨‹ã€‚
    
    
**ä¸è§£ææ¨¡å—ï¼Œå¯ä»¥æ„å»ºæ—¶é—´**
å¦‚æœä¸åšæ¨¡å—è§£æï¼Œé‚£æ–‡ä»¶å†…å®¹è¯»å–åï¼Œloaderå¤„ç†åï¼Œç›´æ¥å°±ä¿å­˜ä¸‹æ¥ï¼Œä½œä¸ºæœ€ç»ˆçš„èµ„æºï¼›å¦‚æœä¸ä½¿ç”¨loaderï¼Œé‚£æºç å°±æ˜¯æ‰“åŒ…ç»“æœã€‚    
    
    
**ä¸éœ€è¦è§£æçš„æ¨¡å—**
1. æ¨¡å—ä¸­æ²¡æœ‰å…¶ä»–ä¾èµ–ï¼Œæ¯”å¦‚`lodash` `moment`ç­‰ç‹¬ç«‹åŒ…

    
**é…ç½®ä¸éœ€è¦è§£æçš„æ¨¡å—**
```js
  // webpack.config.js
  module.exports = {
      module: {
          noParse: /^(lodash|moment)$/,
      }
  }
```

## 2. ä¼˜åŒ–loaderæ€§èƒ½

### åªå¤„ç†éœ€è¦çš„æ–‡ä»¶
    
> æ ¸å¿ƒï¼šé™åˆ¶loaderçš„åº”ç”¨èŒƒå›´ï¼Œéå¿…è¦ä¸ä½¿ç”¨ã€‚
    
æ¯”å¦‚`babel-loader`,å¯¹äº`loadash`è¿™æ ·çš„åº“ï¼Œä¸éœ€è¦å†ä½¿ç”¨babelè¿›è¡Œè½¬æ¢ï¼Œå¯ä»¥é…ç½®`exclude`
`node_modules`ä¸­çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¤§éƒ¨åˆ†æ˜¯å·²ç»è½¬æ¢è¿‡çš„ï¼Œä¸éœ€è¦å†ä½¿ç”¨babelè¿›è¡Œè½¬æ¢

```js
  // webpack.config.js
  module.exports = {
    module: {
      rules:[
        {
          test: /\.js$/,
          exclude: /node_modules/,
          use: 'babel-loader',
        },
        // æˆ–
        {
          test: /\.js$/,
          include: path.resolve(__dirname, 'src'),
          use: 'babel-loader',
        }
      ]
    }
  }

```

### ç¼“å­˜loaderçš„ç»“æœ
    
ts-loaderã€babel-loaderã€eslint-loader ç­‰éƒ½æ˜¯è€—æ—¶loader
> æ ¸å¿ƒï¼šloaderè½¬æ¢è¿‡çš„å†…å®¹ï¼Œç¼“å­˜èµ·æ¥ï¼Œå¤ç”¨æ²¡æœ‰å˜åŒ–çš„æ–‡ä»¶
    
`cache-loader` æ˜¯ Webpack ä¸­ä¸€ä¸ªç”¨äº`ç¼“å­˜ loader æ‰§è¡Œç»“æœ`çš„å·¥å…·ã€‚å®ƒä¼šå°†ç»è¿‡è€—æ—¶çš„ loaderï¼ˆå¦‚ babel-loaderã€ts-loaderï¼‰å¤„ç†åçš„ç»“æœç¼“å­˜åˆ°ç£ç›˜ä¸­ï¼Œå½“ä¸‹æ¬¡æ„å»ºæ—¶å¦‚æœæ–‡ä»¶æ²¡æœ‰å˜åŒ–ï¼Œå°±ç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ï¼Œé¿å…é‡å¤å¤„ç†ã€‚
    
```js
  module.exports = {
    module: {
      rules: [
        {
          test: /\.js$/,
          use: [
            'cache-loader',// é€šå¸¸æ”¾åœ¨å…¶ä»–è€—æ—¶çš„ loader å‰é¢ï¼ˆé¡ºåºä»å³å¾€å·¦æ‰§è¡Œï¼‰
            'babel-loader',
          ],
          include: path.resolve('src'),
        },
      ],
    },
  };
```

```js
  // webpack5 ä¸­çš„æŒä¹…åŒ–ç¼“å­˜
  module.exports = {
    cache: {
      type: 'filesystem',
      buildDependencies: {
        config: [__filename], // å½“é…ç½®æ”¹å˜æ—¶ï¼Œç¼“å­˜å¤±æ•ˆ
      },
    },
  };
```


### loaderå¤šçº¿ç¨‹è¿è¡Œ
    
`thread-loader`æ˜¯ Webpack ä¸­ç”¨äº **å¤šçº¿ç¨‹æ‰“åŒ…æ„å»º** çš„ä¸€ä¸ª loaderï¼Œå®ƒå¯ä»¥å°†è€—æ—¶çš„ loader æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ worker çº¿ç¨‹ä¸­è¿è¡Œï¼Œä»è€Œæå‡æ„å»ºæ€§èƒ½ã€‚
    
åœ¨ Webpack çš„ `rules` ä¸­ä½¿ç”¨ `thread-loader`ï¼Œé€šå¸¸æ”¾åœ¨å…¶ä»–è€—æ—¶çš„ loader å‰é¢
    
ç¼ºç‚¹ï¼š
- æ–°çº¿ç¨‹é‡Œçš„loaderæ— æ³•ä½¿ç”¨webpackçš„apiï¼Œæ— æ³•è®¿é—®é…ç½®
- çº¿ç¨‹çš„åˆ›å»ºé”€æ¯å’Œé€šä¿¡æˆæœ¬ä¹Ÿæ¶ˆè€—æ—¶é—´
    
```js
  module.exports = {
    module: {
      rules: [
        {
          test: /\.js$/,
          use: [
            {
              loader: 'thread-loader',
              options: {
                workers: 3,
              },
            },
            'babel-loader',
          ],
          include: path.resolve('src'),
        },
      ],
    },
  };
```



## 3. çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰

### webpack å¼€å¯HMR
    
åœ¨webpack.config.jsä¸­å¼€å¯HMR
```js
  module.exports = {
    devServer: {
      hot: true,
    },
    plugins: [
      new webpack.HotModuleReplacementPlugin(), // çƒ­æ›¿æ¢æ’ä»¶
    ]
  }
```
    

åœ¨ä»£ç ä¸­å¼€å¯HMR
```js
  if (module.hot) {
    module.hot.accept();
  }
```

### HMR çš„å®ç°åŸç† ğŸ”§
    
åœ¨å¼€å‘æ—¶ï¼Œwebpack-dev-server é€šå¸¸ç»å†äº†ä¸‹é¢è¿™æ ·ä¸€ä¸ªå·¥ä½œæµ
    
- æŒç»­ç›‘å¬ä»£ç å˜åŒ–

- ä»£ç å˜åŒ–
- é‡æ–°æ‰“åŒ…
- æµè§ˆå™¨è¯·æ±‚èµ„æº
- æµè§ˆå™¨æ‰§è¡Œä»£ç 
- ä»£ç å˜åŒ–.........

---
    
å…·ä½“åœ°ï¼š

1. WebSocket è¿æ¥
webpack-dev-server å’Œæµè§ˆå™¨ä¹‹é—´å»ºç«‹ WebSocket è¿æ¥ï¼Œç”¨äºå®æ—¶é€šä¿¡ã€‚

2. æ–‡ä»¶ç›‘å¬
webpack ç›‘å¬æºä»£ç æ–‡ä»¶çš„å˜åŒ–ï¼Œå½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼š
- webpack é‡æ–°ç¼–è¯‘å˜åŒ–çš„æ¨¡å—
- ç”Ÿæˆæ–°çš„æ¨¡å—ä»£ç 
- è®¡ç®—æ¨¡å—å·®å¼‚ï¼ˆhashï¼‰

3. é€šçŸ¥æœºåˆ¶
```js
// webpack-dev-server é€šè¿‡ WebSocket å‘æµè§ˆå™¨å‘é€æ¶ˆæ¯
{
  type: 'ok',
  hash: 'newHash123',
  modules: ['./src/components/Button.js']
}
```

4. æ¨¡å—æ›´æ–°æµç¨‹
```js
// æµè§ˆå™¨ç«¯çš„HMRè¿è¡Œæ—¶
if (module.hot) {
  // 1. æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
  module.hot.check().then(outdatedModules => {
    if (outdatedModules) {
      // 2. åº”ç”¨æ›´æ–°
      return module.hot.apply({
        ignoreUnaccepted: true
      });
    }
  }).then(updatedModules => {
    // 3. æ›´æ–°æˆåŠŸï¼Œé¡µé¢çŠ¶æ€ä¿æŒ
    console.log('HMR æ›´æ–°æˆåŠŸ');
  });
}
```

#### CSS æ¨¡å—çš„ HMR
```js
// style-loader è‡ªåŠ¨æ”¯æŒ CSS HMR
module.exports = {
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      }
    ]
  }
}
```

---


