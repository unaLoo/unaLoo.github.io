---
title: å¼‚æ­¥ç¼–ç¨‹ï¼šä»å¼‚æ­¥I/Oæ¨¡å‹åˆ°åç¨‹
date: 2025-08-15
tags:
  - å¼‚æ­¥ç¼–ç¨‹
---
# å¼‚æ­¥ç¼–ç¨‹ï¼šä»å¼‚æ­¥I/Oæ¨¡å‹åˆ°åç¨‹

æœ€è¿‘å‡†å¤‡ç”¨ `FastAPI` å†™æ¯•è®¾å·¥ä½œçš„åç«¯ï¼Œä¹‹æ‰€ä»¥é€‰ä»–æ˜¯å› ä¸ºè‡ªå¸¦`swagger` æ”¯æŒï¼Œä¹Ÿæœ‰ç±»å‹ç³»ç»Ÿï¼Œä¹‹å‰å†™è¿‡ä¸€äº›ï¼Œä½“éªŒè¿˜ä¸é”™ã€‚ä»Šå¤©åœ¨ç¿»çœ‹ FastAPI çš„å®˜æ–¹æ–‡æ¡£æ—¶ï¼Œå‘ç°ä¸€ä¸ªå°†å¹¶å‘è®²çš„æœ‰å£°æœ‰è‰²çš„æ–‡æ¡£ã€‚[å¹¶å‘ async / await - FastAPI](https://fastapi.tiangolo.com/zh/async/)

JS ä¸­æœ‰  async/await, python ä¸­ä¹Ÿæœ‰ï¼Œç†è§£ä¸åŒè¯­è¨€ä¹‹é—´é¢å¯¹æŸäº›é—®é¢˜çš„ç›¸ä¼¼æ€§å¤„ç†ï¼Œå¿…ç„¶æœ‰åŠ©äºè¿›ä¸€æ­¥ç†è§£ä¸åŒè¯­è¨€å¤„ç†åŒæ ·é—®é¢˜çš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚

> Python çš„ç°ä»£ç‰ˆæœ¬æ”¯æŒé€šè¿‡ä¸€ç§å«"åç¨‹"(`async`Â å’ŒÂ `await`Â è¯­æ³•)çš„ä¸œè¥¿æ¥å†™â€å¼‚æ­¥ä»£ç â€œã€‚

## I/O æ“ä½œ

å¹¿ä¹‰ä¸Šçš„ I/O ï¼ˆInput/Outputï¼‰æŒ‡çš„æ˜¯**è®¡ç®—æœºç³»ç»Ÿä¸å¤–éƒ¨ä¸–ç•Œä¹‹é—´çš„æ•°æ®äº¤äº’**ï¼Œå°±æ˜¯è®¡ç®—æœºä»å¤–éƒ¨è®¾å¤‡è·å–æ•°æ®ï¼ˆè¾“å…¥ï¼‰ï¼Œæˆ–å‘å¤–éƒ¨è®¾å¤‡å‘é€æ•°æ®ï¼ˆè¾“å‡ºï¼‰çš„è¿‡ç¨‹ã€‚

ä»£ç ä¸­çš„ I/O æ“ä½œå°±æ˜¯ï¼Œ**ç¨‹åº**ä¸å¤–éƒ¨ä¸–ç•Œçš„æ•°æ®äº¤äº’ï¼Œå¯¹äºç¨‹åºè€Œè¨€ï¼Œä»–çš„å¤–éƒ¨ä¸–ç•Œå°±åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€é”®ç›˜ã€å…¶ä»–ç¨‹åºç­‰ç­‰ï¼Œä¸‹é¢ä¸»è¦ä»¥ä»£ç ä¸­çš„ I/O è¿›è¡Œè¯´æ˜ã€‚

`c = a + b`è¿™æ ·çš„ç®€å•ä»»åŠ¡ä¸æ˜¯ `I/O`æ“ä½œ

ç½‘ç»œè¯·æ±‚å°±æ˜¯ä¸€ä¸ª `I/O` æ“ä½œï¼Œå½“ä½ åœ¨ä»£ç ä¸­å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œæ•°æ®éœ€è¦ä»å†…å­˜ç»è¿‡æ“ä½œç³»ç»Ÿå†…æ ¸è¿›è¡Œæ•°æ®åŒ…çš„åŒ…è£…å’Œå‘é€ï¼Œæ¯”å¦‚ç»è¿‡åº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚ã€é“¾è·¯å±‚ã€ç‰©ç†å±‚ç­‰ç­‰ä¸€æ­¥æ­¥**åŒ…è£…è¿‡ç¨‹**æœ€ç»ˆæ‰å¾—ä»¥å‘å‡ºã€‚

å¯ä»¥çœ‹åˆ°ï¼Œ`I/O` æ“ä½œçš„ä¸¤å¤§ç‰¹å¾å°±æ˜¯ **å¤–éƒ¨æ•°æ®äº¤äº’**  **æ“ä½œç³»ç»Ÿå†…æ ¸å‚ä¸**

å¸¸è§çš„`I/O`ä»»åŠ¡åŒ…æ‹¬ï¼š
- ç¨‹åºé€šè¿‡ç½‘ç»œå‘é€æ•°æ®
- ç¨‹åºé€šè¿‡ç½‘ç»œæ¥å—æ•°æ®
- ç¨‹åºè¯»å–æœ¬åœ°æ–‡ä»¶ï¼ˆæœ¬è´¨æ˜¯è®©æ“ä½œç³»ç»Ÿè¯»å–ç£ç›˜æ–‡ä»¶å†…å®¹å†ä¾›ç»™ç¨‹åºï¼‰
- ç¨‹åºå†™å…¥æœ¬åœ°æ–‡ä»¶ï¼ˆåŒç†ï¼‰
- API è¿œç¨‹è°ƒç”¨ (RPC)
- æ•°æ®åº“æ“ä½œ

## å¼‚æ­¥

I/O æ“ä½œæ˜¯ç¨‹åºæ€§èƒ½çš„**ä¸»è¦ç“¶é¢ˆ**ä¹‹ä¸€ã€‚

CPU çš„è¿è¡Œé€Ÿåº¦éå¸¸å¿«ï¼Œä»¥çº³ç§’ï¼ˆ10âˆ’9 ç§’ï¼‰ä¸ºå•ä½ã€‚è€Œ I/O æ“ä½œï¼Œæ¯”å¦‚ä»ç¡¬ç›˜è¯»å–æ•°æ®ï¼Œé€Ÿåº¦åˆ™æ…¢å¾—å¤šï¼Œå¯èƒ½éœ€è¦æ¯«ç§’ç”šè‡³æ›´é•¿ã€‚è¿™ç§å·¨å¤§çš„é€Ÿåº¦å·®å¼‚æ„å‘³ç€ï¼Œå¦‚æœç¨‹åºåœ¨æ‰§è¡Œ I/O æ“ä½œæ—¶â€œå‚»å‚»åœ°â€ç­‰å¾…ï¼Œé‚£ä¹ˆ CPU å°±ä¼šé•¿æ—¶é—´ç©ºé—²ï¼Œå¯¼è‡´ç¨‹åºè¿è¡Œæ•ˆç‡ä½ä¸‹ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¼–ç¨‹è¯­è¨€å’Œæ“ä½œç³»ç»Ÿæä¾›äº†å¤šç§å¤„ç† I/O çš„æ¨¡å‹ï¼š

- **åŒæ­¥ I/Oï¼ˆSynchronous I/Oï¼‰ï¼š** è¿™æ˜¯æœ€ç®€å•çš„æ¨¡å‹ã€‚å½“ç¨‹åºå‘èµ·ä¸€ä¸ª I/O è¯·æ±‚ï¼ˆæ¯”å¦‚ `file.read()`ï¼‰åï¼Œå®ƒä¼š**æš‚åœæ‰§è¡Œ**ï¼Œç›´åˆ°æ•°æ®è¯»å–å®Œæ¯•åæ‰ä¼šç»§ç»­ã€‚
    
- **å¼‚æ­¥ I/Oï¼ˆAsynchronous I/Oï¼‰ï¼š** è¿™ç§æ¨¡å‹å…è®¸ç¨‹åºå‘èµ· I/O è¯·æ±‚å**ç«‹å³è¿”å›**ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚å½“ I/O æ“ä½œå®Œæˆåï¼Œç³»ç»Ÿä¼šé€šè¿‡å›è°ƒã€äº‹ä»¶æˆ–é€šçŸ¥æ¥å‘Šè¯‰ç¨‹åºã€‚è¿™åœ¨éœ€è¦å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼ˆå¦‚ç½‘ç»œæœåŠ¡å™¨ï¼‰æ—¶éå¸¸æœ‰ç”¨ã€‚

è½å®åˆ°ç¼–ç¨‹è¯­è¨€çš„**å¼‚æ­¥ä»£ç **ä¸Šï¼Œå¼‚æ­¥ä»£ç æ„å‘³ç€**ç¼–ç¨‹è¯­è¨€**å¯ä»¥å‘Šè¯‰**è®¡ç®—æœºç¨‹åº**åœ¨ä»£ç ä¸­çš„æŸä¸ªç‚¹ï¼Œå®ƒ(ç¨‹åº)ä¸éœ€è¦ç­‰å¾…æŸä¸ªä»»åŠ¡(T)å®Œæˆï¼Œå¯ä»¥å…ˆåšå…¶ä»–äº‹æƒ…ã€‚å½“ä»»åŠ¡ T å®Œæˆæ—¶ï¼Œå®ƒ(ç¨‹åº)å†æ‰§è¡Œä¾èµ– T æ‰§è¡Œç»“æœçš„ä»£ç (å›è°ƒ)ã€‚

åœ¨å¤§å¤šæ•° Web åº”ç”¨çš„åœºæ™¯ä¸‹ï¼ŒæœåŠ¡å™¨ä¼šæ”¶åˆ°æ¥è‡ªä¸åŒå®¢æˆ·ç«¯ï¼Œä¸åŒç½‘ç»œæ¡ä»¶ä¸‹å‘è¿‡æ¥çš„è¯·æ±‚ï¼Œå¿…é¡»è¦æœ‰è¿™æ ·çš„å¼‚æ­¥æœºåˆ¶ã€‚
## async / await

ç°ä»£ç‰ˆæœ¬çš„ Python æœ‰ä¸€ç§éå¸¸ç›´è§‚çš„æ–¹å¼æ¥å®šä¹‰å¼‚æ­¥ä»£ç ã€‚è¿™ä½¿å®ƒçœ‹èµ·æ¥å°±åƒæ­£å¸¸çš„"é¡ºåº"ä»£ç ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™"ç­‰å¾…"ï¼ŒåŸºæœ¬å’Œ JS çš„ async / await è¯­æ³•ç±»ä¼¼ã€‚

å½“æœ‰ä¸€ä¸ªæ“ä½œéœ€è¦ç­‰å¾…æ‰èƒ½ç»™å‡ºç»“æœï¼Œä¸”æ”¯æŒè¿™ä¸ªæ–°çš„ Python ç‰¹æ€§æ—¶ï¼Œä½ å¯ä»¥ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š

`burgers = await get_burgers(2)`

è¿™é‡Œçš„å…³é”®æ˜¯Â `await`ã€‚å®ƒå‘Šè¯‰ Python å®ƒå¿…é¡»ç­‰ â¸Â `get_burgers(2)`Â å®Œæˆå®ƒçš„å·¥ä½œ ğŸ•™ ï¼Œç„¶åå°†ç»“æœå­˜å‚¨åœ¨Â `burgers`Â ä¸­ã€‚**è¿™æ ·ï¼ŒPython å°±ä¼šçŸ¥é“æ­¤æ—¶å®ƒå¯ä»¥å»åšå…¶ä»–äº‹æƒ… ğŸ”€ â¯ ï¼ˆæ¯”å¦‚æ¥æ”¶å¦ä¸€ä¸ªè¯·æ±‚ï¼‰ã€‚**

> æ³¨æ„ï¼Œæ‰€è°“`await` å¹¶ä¸æ˜¯å‘Šè¯‰ `python` è¦ä¸€ç›´åœ¨é‚£å‚»å‚»åœ°ç­‰ä»»åŠ¡å®Œæˆã€‚è€Œæ˜¯å‘Šè¯‰ python è¿™éƒ¨åˆ†ä»£ç åœ¨è¿™é‡Œ**æš‚åœ**ï¼Œå…ˆå»å¹²åˆ«çš„ï¼Œ**å½“** `get_burgers(2)` å®Œæˆäº†å†å›æ¥æŠŠç»“æœå­˜åœ¨ `burgers` ä¸­

è¦ä½¿Â `await`Â å·¥ä½œï¼Œå®ƒå¿…é¡»ä½äº`async`å‡½æ•°å†…

```python
async def get_burgers(number: int):     
	# Do some asynchronous stuff to create the burgers    
	return burgers
```

ä½¿ç”¨Â `async def`ï¼ŒPython å°±çŸ¥é“åœ¨è¯¥å‡½æ•°ä¸­ï¼Œå®ƒå°†é‡ä¸ŠÂ `await`ï¼Œå¹¶ä¸”å®ƒå¯ä»¥"æš‚åœ" â¸ æ‰§è¡Œè¯¥å‡½æ•°ï¼Œç›´è‡³æ‰§è¡Œå…¶ä»–æ“ä½œ ğŸ”€ åå›æ¥ã€‚

ç±»æ¯” JS ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŒœæƒ³ï¼Œ`async function`å¯¹åº”äº† `*function`ï¼Œå£°æ˜äº†ä¸€ä¸ª`generator`å‡½æ•°ï¼Œ`await` å°±å¯¹åº”äº†ä¸€ä¸ª `yield` æ“ä½œç¬¦ï¼Œæ§åˆ¶ç¨‹åºçš„æš‚åœæ‰§è¡Œã€‚ 

## åç¨‹

åç¨‹æ˜¯å¼‚æ­¥ç¼–ç¨‹ä¸­çš„å…³é”®æŠ€æœ¯
### æ¦‚å¿µ

> åç¨‹æ˜¯ä¸€ç§**ç”¨æˆ·æ€**çš„**è½»é‡çº§**çº¿ç¨‹ï¼Œå®ƒç”±ç¨‹åºè‡ªå·±è°ƒåº¦ï¼Œä¸éœ€è¦æ“ä½œç³»ç»Ÿå†…æ ¸æ¥å…¥ï¼Œè¿™æ„å‘³ç€åç¨‹çš„åˆ‡æ¢ã€è°ƒåº¦éå¸¸å¿«ã€‚

### Async / Await -- è‡ªåŠ¨åŒ–åç¨‹

**åœ¨ JS ä¸­çš„å®ç°ï¼š**

- åœ¨ JS ä¸­çš„è¡¨ç°ä¸ºä¸€ä¸ªå¯ä»¥**æš‚åœå’Œæ¢å¤æ‰§è¡Œ**çš„å‡½æ•°ã€‚
- `generator / yield` æ˜¯åç¨‹çš„å®ç°è¯­æ³•ã€‚
- async / await æ˜¯åŸºäº `generator / yield` çš„é«˜çº§è¯­æ³•ç³–


ä¸ºäº†è§£å†³ `generator` åœ¨å¤„ç†å¼‚æ­¥æ—¶çš„éº»çƒ¦ï¼ŒJavaScript å¼•å…¥äº† `async/await`ã€‚å®ƒåœ¨åº•å±‚ä¾ç„¶ä½¿ç”¨äº† `generator` çš„æœºåˆ¶ï¼Œä½†åšäº†ä¸¤ä»¶é‡è¦çš„äº‹æƒ…ï¼š

1. **è‡ªåŠ¨åŒ–æ‰§è¡Œ**ï¼š`async` å‡½æ•°çš„æ‰§è¡Œæµä¸å†éœ€è¦ä½ æ‰‹åŠ¨è°ƒç”¨ `next()`ã€‚
    
2. **å†…ç½®å¯¹ Promise çš„æ”¯æŒ**ï¼š`await` å…³é”®å­—ä¸“é—¨ç”¨æ¥ç­‰å¾…ä¸€ä¸ª Promise å¯¹è±¡çš„è§£å†³ã€‚å½“ `await` é‡åˆ°ä¸€ä¸ª Promise æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æš‚åœæ‰§è¡Œï¼Œç›´åˆ° Promise å¾—åˆ°ç»“æœã€‚

async / await æ˜¯å®ç°è‡ªåŠ¨åŒ–è°ƒç”¨å’Œ promise æ”¯æŒçš„å‘¢
- ä¸€ä¸ª async å‡½æ•°ä¼šå˜æˆä¸€ä¸ª generator å‡½æ•°
- await ä¼šå˜ä¸º yield
- å¤–å±‚ç”±ä¸€ä¸ª Promise åŒ…è£…å™¨æ§åˆ¶è‡ªåŠ¨æ‰§è¡Œ

```js
// åŸå§‹å‡½æ•°
async function greet() { 
	const result = await Promise.resolve('Hello'); 
	return result + ' World'; 
}
```

```js
// è‡ªåŠ¨æ‰§è¡Œå™¨ï¼Œæ¥æ”¶ä¸€ä¸ªGeneratorå‡½æ•°
function asyncToGenerator(generatorFunc) {
  return function() {
    const generator = generatorFunc.apply(this, arguments);
	// æ•´ä½“è¿”å›ä¸€ä¸ª promiseï¼Œæ§åˆ¶å‡½æ•°çš„è¿”å›å€¼
    return new Promise((resolve, reject) => {
      // åŸºäº generator.next é€’å½’è°ƒç”¨
      function step(nextResult) {
        // é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œdone === true
        if (nextResult.done) {
          return resolve(nextResult.value);
        }
		// åŒ…è£…å…¼å®¹ï¼Œå¤„ç† yield æ™®é€šå€¼æˆ–promiseçš„æƒ…å†µ 
        Promise.resolve(nextResult.value).then(
          res => {
            step(generator.next(res));
          },
          err => {
            step(generator.throw(err));
          }
        );
      }
      step(generator.next());
    });
  };
}
// è¢«è½¬è¯‘åçš„ greet å‡½æ•°
const greet = asyncToGenerator(function*() {
  const result = yield Promise.resolve('Hello');
  return result + ' World';
});
```