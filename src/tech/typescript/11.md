---
title: 11-ç±»å‹æ–­è¨€
date: 2025-10-04
tags:
  - TypeScript
---
# TypeScript çš„ç±»å‹æ–­è¨€

## ç®€ä»‹

è™½ç„¶æœ‰è‡ªåŠ¨ç±»å‹æ¨æ–­ï¼Œä½†æ˜¯æœ‰æ—¶éš¾ä»¥å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚

TypeScript æä¾›äº†â€œ**ç±»å‹æ–­è¨€**â€è¿™æ ·ä¸€ç§æ‰‹æ®µï¼Œå…è®¸æ–­è¨€æŸä¸ªå€¼çš„ç±»å‹ï¼Œç¼–è¯‘å™¨ç›´æ¥é‡‡ç”¨æ–­è¨€ç»™å‡ºçš„ç±»å‹ã€‚

```ts
// ä¸¤ç§å†™æ³•
<Type>value;
value as Type;
```

ä¸Šé¢ä¸¤ç§è¯­æ³•æ˜¯ç­‰ä»·çš„ï¼Œ`value`è¡¨ç¤ºå€¼ï¼Œ`Type`è¡¨ç¤ºç±»å‹ã€‚æ—©æœŸåªæœ‰è¯­æ³•ä¸€ï¼Œåæ¥å› ä¸ºå¼€å§‹æ”¯æŒ React çš„ JSX è¯­æ³•ï¼Œä¸ºé¿å…å†²çªï¼Œå¼•å…¥è¯­æ³•äºŒã€‚

```ts
// æŠ¥é”™
const p: { x: number } = { x: 0, y: 0 };

// å› ä¸ºç›´æ¥å¯¹è±¡èµ‹å€¼ï¼Œé»˜è®¤çš„æ˜¯è¿™æ ·ä¸€ä¸ªå­—é¢é‡ç±»å‹
type T = {
    x: 0,
    y: 0
}
const p: T = { x: 0, y: 0 } // æ­£ç¡®

// æ­£ç¡®
const p0: { x: number } = { x: 0, y: 0 } as { x: number };
// æ­£ç¡®
const p1: { x: number } = { x: 0, y: 0 } as { x: number; y: number };
```

**åº”ç”¨ï¼šæ–­è¨€ dom ç±»å‹**

```ts
const username = document.getElementById("username");

if (username) {
  (username as HTMLInputElement).value; // æ­£ç¡®
}
```

**åº”ç”¨ï¼šæŒ‡å®šå˜é‡çš„å…·ä½“ç±»å‹ã€‚**

```ts
const value: unknown = "Hello World";

const s1: string = value; // æŠ¥é”™
const s2: string = value as string; // æ­£ç¡®
```

**åº”ç”¨ï¼šä¸ºè”åˆç±»å‹æŒ‡å®šå…·ä½“ç±»å‹ã€‚**

```ts
const s1: number | string = "hello";
const s2: number = s1 as number;
```

æ€»çš„æ¥è¯´ï¼Œç±»å‹æ–­è¨€ä¸åº”æ»¥ç”¨ï¼Œå› ä¸ºå®ƒæ”¹å˜äº† TypeScript çš„ç±»å‹æ£€æŸ¥ï¼Œå¾ˆå¯èƒ½åŸ‹ä¸‹é”™è¯¯éšæ‚£

## ç±»å‹æ–­è¨€çš„æ¡ä»¶

ç±»å‹æ–­è¨€å¹¶ä¸æ„å‘³ç€ï¼Œå¯ä»¥æŠŠæŸä¸ªå€¼æ–­è¨€ä¸ºä»»æ„ç±»å‹ï¼Œä½¿ç”¨å‰ææ˜¯**å€¼çš„å®é™…ç±»å‹ä¸æ–­è¨€çš„ç±»å‹å¿…é¡»æ»¡è¶³æ¡ä»¶** ï¼Œ`expr`æ˜¯`T`çš„å­ç±»å‹ï¼Œæˆ–è€…`T`æ˜¯`expr`çš„å­ç±»å‹ã€‚

```ts
expr as T;
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»å‹æ–­è¨€è¦æ±‚å®é™…ç±»å‹ä¸æ–­è¨€ç±»å‹å…¼å®¹ï¼Œå®é™…ç±»å‹å¯ä»¥æ–­è¨€ä¸ºä¸€ä¸ª**çˆ¶ç±»å‹æˆ–å­ç±»å‹**ï¼Œä½†ä¸èƒ½æ–­è¨€ä¸ºä¸€ä¸ªå®Œå…¨æ— å…³çš„ç±»å‹ã€‚

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ–­è¨€æˆä¸€ä¸ªå®Œå…¨æ— å…³çš„ç±»å‹ã€‚é€šè¿‡è¿ç»­ä¸¤æ¬¡æ–­è¨€å®ç°ï¼Œå…ˆæ–­è¨€æˆ unknown æˆ– any ï¼Œç„¶åå†æ–­è¨€ä¸ºç›®æ ‡ç±»å‹ã€‚

```ts
// æˆ–è€… <T><unknown>expr
expr as unknown as T;
```
## as const æ–­è¨€

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`let` å‘½ä»¤å£°æ˜çš„å˜é‡ï¼Œä¼šè¢«ç±»å‹æ¨æ–­ä¸ºåŸºæœ¬ç±»å‹ä¹‹ä¸€ï¼›`const` å‘½ä»¤å£°æ˜çš„å˜é‡ä¼šè¢«æ¨æ–­ä¸º**å€¼ç±»å‹å¸¸é‡**ã€‚

```ts
// s1 string
let s1 = "JavaScript";

// s2 â€œJavaScriptâ€
const s2 = "JavaScript";
```

æœ‰äº›æ—¶å€™ï¼Œlet å˜é‡ä¼šå‡ºç°ä¸€äº›æ„æƒ³ä¸åˆ°çš„æŠ¥é”™ï¼Œå˜æ›´æˆ const å˜é‡å°±èƒ½æ¶ˆé™¤æŠ¥é”™ã€‚

```ts
let s = "JavaScript";

type Lang = "JavaScript" | "TypeScript" | "Python";

function setLang(language: Lang) {
  /* ... */
}

setLang(s); // æŠ¥é”™ï¼Œsçš„ç±»å‹è¢«æ¨æ–­ä¸ºstring
```

TypeScript æä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ç±»å‹æ–­è¨€`as const`ï¼Œç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œæ¨æ–­ç±»å‹æ—¶ï¼Œå¯ä»¥**å°†è¿™ä¸ªå€¼æ¨æ–­ä¸ºå¸¸é‡**ï¼Œå³æŠŠ let å˜é‡æ–­è¨€ä¸º const å˜é‡ï¼Œä»è€ŒæŠŠå†…ç½®çš„åŸºæœ¬ç±»å‹å˜æ›´ä¸ºå€¼ç±»å‹ã€‚

```ts
let s = "JavaScript" as const; // s çš„ç±»å‹è¢«æ¨æ–­ä¸º â€œJavaScriptâ€
setLang(s); // æ­£ç¡®
```

ä½¿ç”¨äº†`as const`æ–­è¨€ä»¥åï¼Œlet å˜é‡å°±ä¸èƒ½å†æ”¹å˜å€¼äº†ã€‚

```ts
let s = "JavaScript" as const;
s = "Python"; // æŠ¥é”™
```

`as const`æ–­è¨€å¯ä»¥ç”¨äºæ•´ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥ç”¨äºå¯¹è±¡çš„å•ä¸ªå±æ€§ï¼Œè¿™æ—¶å®ƒçš„ç±»å‹ç¼©å°æ•ˆæœæ˜¯ä¸ä¸€æ ·çš„ã€‚

```ts
const v1 = {
  x: 1,
  y: 2,
}; // ç±»å‹æ˜¯ { x: number; y: number; }

const v2 = {
  x: 1 as const,
  y: 2,
}; // ç±»å‹æ˜¯ { x: 1; y: number; }

const v3 = {
  x: 1,
  y: 2,
} as const; // ç±»å‹æ˜¯ { readonly x: 1; readonly y: 2; }
```

æ€»ä¹‹ï¼Œ`as const`ä¼šå°†å­—é¢é‡çš„ç±»å‹æ–­è¨€ä¸ºä¸å¯å˜ç±»å‹ï¼Œç¼©å°æˆ TypeScript å…è®¸çš„æœ€å°ç±»å‹ã€‚

ç”±äº`as const`ä¼šå°†æ•°ç»„å˜æˆåªè¯»å…ƒç»„ï¼Œå¯ä»¥ç”¨äºå‡½æ•°çš„å‰©ä½™å‚æ•°

```ts
function add(x: number, y: number) {
  return x + y;
}

const nums = [1, 2];
const total = add(...nums); // æŠ¥é”™
```


## éç©ºæ–­è¨€

å¯¹äºé‚£äº›å¯èƒ½ä¸ºç©ºçš„å˜é‡ï¼ˆå³å¯èƒ½ç­‰äº`undefined`æˆ–`null`ï¼‰ï¼ŒTypeScript æä¾›äº†éç©ºæ–­è¨€ï¼Œä¿è¯è¿™äº›å˜é‡ä¸ä¼šä¸ºç©ºï¼Œå†™æ³•æ˜¯åœ¨å˜é‡ååé¢åŠ ä¸Šæ„Ÿå¹å·`!`ã€‚

éç©ºæ–­è¨€åœ¨å®é™…ç¼–ç¨‹ä¸­å¾ˆæœ‰ç”¨ï¼Œæœ‰æ—¶å¯ä»¥çœå»ä¸€äº›é¢å¤–çš„åˆ¤æ–­ã€‚

```ts
const root = document.getElementById("root")!;
```

ä¸è¿‡ï¼Œéç©ºæ–­è¨€ä¼šé€ æˆå®‰å…¨éšæ‚£ï¼Œåªæœ‰åœ¨ç¡®å®šä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ä¸ä¸ºç©ºæ—¶æ‰èƒ½ä½¿ç”¨ã€‚æ¯”è¾ƒä¿é™©çš„åšæ³•è¿˜æ˜¯æ‰‹åŠ¨æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦ä¸ºç©ºã€‚

```ts
const root = document.getElementById("root");

if (root === null) {
  throw new Error("Unable to find DOM element #root");
}

root.addEventListener("click", (e) => {
  /* ... */
});
```

éç©ºæ–­è¨€è¿˜å¯ä»¥ç”¨äºèµ‹å€¼æ–­è¨€ã€‚TypeScript æœ‰ä¸€ä¸ªç¼–è¯‘è®¾ç½®ï¼Œè¦æ±‚ç±»çš„å±æ€§å¿…é¡»åˆå§‹åŒ–ï¼ˆå³æœ‰åˆå§‹å€¼ï¼‰ï¼Œå¦‚æœä¸å¯¹å±æ€§èµ‹å€¼å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨éç©ºæ–­è¨€ï¼Œè¡¨ç¤ºè¿™ä¸¤ä¸ªå±æ€§è‚¯å®šä¼šæœ‰å€¼ï¼Œè¿™æ ·å°±ä¸ä¼šæŠ¥é”™äº†ã€‚

```ts
class Point {
  x!: number; // æ­£ç¡®
  y!: number; // æ­£ç¡®

  constructor() {
    // ...
  }
}
```

å¦å¤–ï¼Œéç©ºæ–­è¨€åªæœ‰åœ¨æ‰“å¼€ç¼–è¯‘é€‰é¡¹`strictNullChecks`æ—¶æ‰æœ‰æ„ä¹‰ã€‚å¦‚æœä¸æ‰“å¼€è¿™ä¸ªé€‰é¡¹ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šæ£€æŸ¥æŸä¸ªå˜é‡æ˜¯å¦å¯èƒ½ä¸º`undefined`æˆ–`null`ã€‚

## ğŸ”¦ æ–­è¨€å‡½æ•° 

æ–­è¨€å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šå‡½æ•°ï¼Œç”¨äºä¿è¯å‡½æ•°å‚æ•°ç¬¦åˆæŸç§ç±»å‹ã€‚å¦‚æœå‡½æ•°å‚æ•°è¾¾ä¸åˆ°è¦æ±‚ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ï¼Œä¸­æ–­ç¨‹åºæ‰§è¡Œï¼›å¦‚æœè¾¾åˆ°è¦æ±‚ï¼Œå°±ä¸è¿›è¡Œä»»ä½•æ“ä½œï¼Œè®©ä»£ç æŒ‰ç…§æ­£å¸¸æµç¨‹è¿è¡Œã€‚

ä¸ºäº†æ›´æ¸…æ™°åœ°è¡¨è¾¾æ–­è¨€å‡½æ•°ï¼ŒTypeScript 3.7 å¼•å…¥äº†æ–°çš„ç±»å‹å†™æ³•ã€‚

```ts
function isString(value: unknown): asserts value is string {
    if (typeof value !== "string") throw new Error("Not a string");
}
let x: any = 1997  // x çš„ç±»å‹ä¸ºä»»æ„å˜é‡
isString(x)
x.slice(1) // x çš„ç±»å‹ä¸º string
```

ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œå‡½æ•°`isString()`çš„è¿”å›å€¼ç±»å‹å†™æˆ`asserts value is string`ï¼Œå…¶ä¸­`asserts`å’Œ`is`éƒ½æ˜¯å…³é”®è¯ï¼Œ`value`æ˜¯å‡½æ•°çš„å‚æ•°åï¼Œ`string`æ˜¯å‡½æ•°å‚æ•°çš„é¢„æœŸç±»å‹ã€‚

ä½¿ç”¨äº†æ–­è¨€å‡½æ•°çš„æ–°å†™æ³•ä»¥åï¼ŒTypeScript å°±ä¼šè‡ªåŠ¨è¯†åˆ«ï¼Œåªè¦æ‰§è¡Œäº†è¯¥å‡½æ•°ï¼Œå¯¹åº”çš„å˜é‡éƒ½ä¸ºæ–­è¨€çš„ç±»å‹ã€‚

ä¾‹å­ï¼šå‡½æ•°`allowsReadAccess()`ç”¨æ¥æ–­è¨€å‚æ•°`level`ä¸€å®šç­‰äº`r`æˆ–`rw`ã€‚

```ts
type AccessLevel = "r" | "w" | "rw";

function allowsReadAccess(level: AccessLevel): asserts level is "r" | "rw" {
  if (!level.includes("r")) throw new Error("Read not allowed");
}
```

å¦‚æœè¦å°†æ–­è¨€å‡½æ•°ç”¨äºå‡½æ•°è¡¨è¾¾å¼ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚

```ts
// å†™æ³•ä¸€
const assertIsNumber = (value: unknown): asserts value is number => {
  if (typeof value !== "number") throw Error("Not a number");
};

// å†™æ³•äºŒ
type AssertIsNumber = (value: unknown) => asserts value is number;

const assertIsNumber: AssertIsNumber = (value) => {
  if (typeof value !== "number") throw Error("Not a number");
};
```

æ³¨æ„ï¼Œ**æ–­è¨€å‡½æ•°**ä¸**ç±»å‹å®ˆå«**å‡½æ•°ï¼ˆtype guardï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„å‡½æ•°ã€‚æ–­è¨€å‡½æ•°**ä¸è¿”å›å€¼**ï¼Œè€Œç±»å‹ä¿æŠ¤å‡½æ•°æ€»æ˜¯**è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼**ã€‚

ä¸‹é¢çš„ `isString` æ˜¯ä¸€ä¸ªç±»å‹å®ˆå«å‡½æ•°ï¼Œæ£€æŸ¥å‚æ•°`value`æ˜¯å¦ä¸ºå­—ç¬¦ä¸²å¹¶è¿”å›boolå€¼ï¼Œ

```ts
function isString(value: unknown): value is string {
  return typeof value === "string";
}
```

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ .next æ–¹æ³•ï¼Œä½“ç°äº†ç±»å‹å®ˆå«å’Œç±»å‹æ–­è¨€çš„åŒºåˆ«ã€‚

```ts
interface NextLike{
	next: (...args:any[])=>any
}
// ç±»å‹å®ˆå«
function hasNext(x:unknown): x is NextLike {
	return typeof x === 'object' &&
				x !== null &&
				'next' in x &&  // æœ‰ 'next' å±æ€§
			typeof x.next === 'function'
}
// ç”¨æ³•ï¼š
let param: any = '123' // æŸä¸ªå˜é‡
if(hasNext(param)){
	param.next() // ä¸æŠ¥é”™
}

// ç±»å‹æ–­è¨€
function assertHasNext(x:unknown): asserts x is NextLike {
	const ans = typeof x === 'object' &&
				x !== null &&
				'next' in x &&  // æœ‰ 'next' å±æ€§
			typeof x.next === 'function'
	if(!ans) throw new Error("don`t have next func")
}
let pp: any = '123' // æŸä¸ªå˜é‡
assertHasNext(pp)
pp.next() 
```